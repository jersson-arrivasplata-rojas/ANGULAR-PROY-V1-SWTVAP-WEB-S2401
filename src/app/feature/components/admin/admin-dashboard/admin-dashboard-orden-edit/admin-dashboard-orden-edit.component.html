<div id="STORE-DASHBOARD-ORDEN-EDIT">

    <div class="spinner-store-block-white-dashboard " id="PRELOAD-DASHBOARD-ORDEN-EDIT" [style.background]="store?.store_customizer_bootstrap[0].theme_color_first" hidden>

    </div>
    <div class="alerts">

    </div>
    <!-- ============ Body content start ============= -->
    <div [ngClass]="{'d-block':preloadDashboard==true,'d-none':preloadDashboard==false}" class="main-content">
        <div class="">
            <button class="btn btn-danger-2 btn-lg mb-2" [routerLink]="['/'+store.stores_uri+'/dashboard/ordenes']">Regresar</button>
        </div>

        <div class="breadcrumb d-flex cursor-pointer" data-toggle="collapse" href="#collapseCliente" aria-expanded="false" aria-controls="collapseCliente" style="justify-content: space-between;">
            <h1>Editar Información del Cliente (Click para Expandir)</h1>
        </div>
        <div class="separator-breadcrumb"></div>
        <div class="collapse col-12" id="collapseCliente">
            <div>
                <div class="form-group row">
                    <label for="Nombre" class="col-sm-2 col-form-label">Nombre (*)</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" [value]="order?.user_first_name" placeholder="Nombre" id="Nombre">
                    </div>
                </div>
                <div class="form-group row">
                    <label for="Apellido" class="col-sm-2 col-form-label">Apellido</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" [value]="order?.user_last_name" placeholder="Apellido" id="Apellido">
                    </div>
                </div>
                <div class="form-group row">
                    <label for="Apellido" class="col-sm-2 col-form-label">Celular</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" [value]="order?.user_celphone" placeholder="Celular" id="Celular">
                    </div>
                </div>
                <div class="form-group row">
                    <label for="Correo" class="col-sm-2 col-form-label">Correo</label>
                    <div class="col-sm-10">
                        <input type="email" class="form-control" [value]="order?.user_email" placeholder="Correo" id="Correo">
                    </div>
                </div>
                <div class="form-group row">
                    <label for="Direccion" class="col-sm-2 col-form-label">Dirección</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" [value]="order?.address" placeholder="Dirección" id="Direccion">
                    </div>
                </div>
                <div class="form-group row">
                    <label for="Referencia" class="col-sm-2 col-form-label">Referencia</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" [value]="order?.optional_address" placeholder="Dirección de Referencia" id="Referencia">
                    </div>
                </div>
                <div class="form-group row">
                    <label for="maps" class="col-sm-2 col-form-label">Url de Google Maps</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" [value]="order?.address_google_maps" placeholder="Url de Google Maps" id="maps">
                    </div>
                </div>
                <!--<fieldset class="form-group row" style="justify-content: flex-end;">
          <legend class="col-form-label col-sm-2 pt-0">Programación</legend>
            <div class="col-sm-10">
              <div class="form-group">
                <label for="recipient-name-2" class="col-form-label">
                    Agregar Fecha:
                    <span class="color-coral">
                        <strong>(*)</strong>
                    </span>
                </label>
                <input type="date" class="form-control border-radius-15" name="num_programmer"  maxlength="100">
                <small>Ejemplo: dd/mm/yyyy</small>
            </div>
            <div class="form-group">
                <label for="recipient-name-2" class="col-form-label">
                    Agregar Hora:
                    <span class="color-coral">
                        <strong>(*)</strong>
                    </span>
                </label>
                <input type="time" class="form-control border-radius-15" name="num_time"  maxlength="100">
                <small>Ejemplo: __:__ </small>
            </div>
          </div>
        </fieldset>-->

                <div class="form-group row">
                    <div class="col-sm-10 text-center">
                        <button type="submit" class="btn btn-first" (click)="saveProfile()">Guardar Perfil de Cliente</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="breadcrumb d-flex cursor-pointer" data-toggle="collapse" href="#collapseOrden" aria-expanded="false" aria-controls="collapseOrden" style="justify-content: space-between;">
            <h1>Editar Productos de la Orden (Click para Expandir)</h1>
        </div>

        <div class="separator-breadcrumb"></div>
        <div class="collapse col-12" id="collapseOrden">

            <div class="row ">
                <div class="col-lg-12">
                    <div class="alert alert-success-2  " style="border-style: none;">
                        <h2 class="col-12 text-center">Cambios de la tabla de productos de la orden</h2>
                        <p class="col-12 text-center mt-2">¡Recuerde que los cambios seran permantentes en los productos!</p>
                    </div>
                </div>
                <div class="col-lg-8 col-md-8 col-sm-8 col-12 pt-5 m-auto">
                    <form #searchFilterForm="ngForm" class="form-search" id="FORM-SEARCH-STORE">

                        <div class="d-flex">
                            <div class="input-group input-search-double-mini mr-2" style="    margin-bottom: -3px">
                                <input style="height: 45px; border-radius: 25px;" type="text" [(ngModel)]="search.product" #product="ngModel" name="product" id="product" class="form-control input text-center" placeholder="¿Qué producto busca?">
                            </div>
                            <button class="btn btn-second    mr-1 border-input admin-inicio-search" (click)="busquedaExplorar()">
                <span class="text-first mr-1">Buscar</span> <i class="dripicons-search"></i>
              </button>
                        </div>
                    </form>
                </div>

            </div>
            <div class="row mt-4" id="PRELOAD-STORE-PRODUCTS-CARGANDO" hidden>
                <div class="col-lg-12 text-center">
                    <div class="card" style="    border-radius: 15px">
                        <div class="card-body">
                            Cargando ...
                        </div>
                    </div>
                </div>
            </div>
            <div class="row  mt-4 justify-content-center" id="ProductCardsVertical">
                <div class="col-lg-2 col-md-3 col-sm-3 col-6  mb-4  div-array-product" *ngFor="let item of array_product let i= index">
                    <div class="card text-first o-hidden mb-3 boder-card-ecoommerce-image-style" style="box-shadow:0 0.125rem 4rem 5px rgb(0 0 0 / 8%)">
                        <div class="card text-first o-hidden boder-card-ecoommerce-image-style">

                            <div *ngIf="item.product_images.length >= 2">
                                <owl-carousel-o [options]="customOptions">
                                    <ng-template carouselSlide *ngFor="let im of item.product_images;  let j= index">
                                        <img class="d-block w-100 slider-img-store card-img boder-card-ecoommerce-image-style img-card-ecoommerce-image-style c" src="{{getImageProduct(im.image)}}?v=1.1" alt="">
                                    </ng-template>
                                </owl-carousel-o>
                            </div>

                            <!--*ngIf="item.product_images.length < 2 || item.product_images.length == 0"-->
                            <img class="card-img boder-card-ecoommerce-image-style img-card-ecoommerce-image-style n" *ngIf="item.product_images.length == 1" src="{{getImageProduct(item.product_images[0].image)}}">


                            <div class="card-img-overlay">
                                <div class="p-1 text-left  font-weight-light d-flex">
                                    <p *ngIf="item.products_unavailable==0" class="product-card-ecommerce-agotado">Agotado</p>

                                </div>
                                <div class="d-flex position-absolute w-100 p-0 add-cart-card-ecommerce-image justify-content-end">

                                    <div class="d-flex justify-content-end flex-direction-column m-0 align-items-end">

                                        <div *ngIf="item.product_type_sale_discount>0&&item.product_type_sale_discount!=null" class="d-flex justify-content-between align-items-center">
                                            <span class="badge badge-pill pt-2 mb-2 pb-2 float-right badge-second badge-discount-store">
                        {{item.product_type_sale_discount}}% dsct
                      </span>
                                        </div>
                                        <div class="d-flex " style="    z-index: 9;">
                                            <input *ngIf="item.products_unavailable==0" class="form-control input-cantidad-store input-cart-inicio-ecommerce-image text-center" placeholder="Cantidad" disabled>

                                            <button *ngIf="item.products_unavailable==0" type="button" class="btn btn-first  btn-sm button-cart-inicio-ecommerce-image cart-negocio" disabled>
                        <i id='spinner-cart-cart1-{{item.products_id}}-i' class="mdi mdi-cart-outline "></i>
                      </button>

                                            <input *ngIf="item.products_unavailable==1" class="form-control input-cantidad-store input-cart-inicio-ecommerce-image text-center" id='input-product-cart1-{{item.products_id}}' [value]="1" type="text" appOnlyNumbersInput="true" placeholder="Cantidad">
                                            <button *ngIf="item.products_unavailable==1" type="button" (click)="addCart(item.products_id,'cart1')" class="btn btn-first  btn-sm button-cart-inicio-ecommerce-image cart-negocio">
                        <i id='spinner-product-cart1-{{item.products_id}}-i' class="fa fa-spinner fa-spin d-none"></i>
                        <i id='spinner-cart-cart1-{{item.products_id}}-i' class="mdi mdi-cart-outline "></i>
                      </button>
                                        </div>
                                    </div>
                                    <div role="alert" #alert class="alert d-none mt-3 text-center mb-0 alert-success alert-success-check" style="z-index: 9;border-style: none;" id='alert-product-cart1-{{item.products_id}}'>
                                        <i class="fas fa-check"></i> ¡Agregado al carrito!
                                    </div>


                                </div>
                            </div>
                        </div>
                        <div class="card-body  p-0 ">
                            <div class="d-flex justify-content-between align-items-center mb-0 card-body-content-ecommerce-image pb-0">
                                <p class="card-title cursor-pointer h5 font-weight-bold mb-0">{{item.products_name}}</p>

                            </div>
                            <div class="d-flex justify-content-between align-items-center mb-0 card-body-content-ecommerce-image pb-0">
                                <div class="font-weight-bold color-black d-flex">
                                    {{(item.product_type_sale_stock==null||item.product_type_sale_stock=='')?0:item.product_type_sale_stock}} Und.
                                </div>
                                <div class="font-weight-bold color-black d-flex">
                                    S/{{item.product_type_sale_price | number : '.1-3'}} {{(item.product_type_sale_type=='unit')?'Und':item.product_type_sale_type}}.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row justify-content-center" id="BUSQUEDA-GRATUITA-PAGINATION">
                <ngb-pagination (pageChange)="paginationChange($event)" [collectionSize]="paginate.total" [(page)]="paginate.current_page" [maxSize]="paginate.per_page" [rotate]="true" [boundaryLinks]="true">
                </ngb-pagination>
            </div>
            <div class="row mt-3">
                <table class="table-store-products mt-4 table table-hover">
                    <thead>
                        <tr>
                            <th scope="col" class="color-black font-size-16 font-weight-700">Producto</th>
                            <th scope="col" class="color-black font-size-16 font-weight-700">Detalles</th>
                            <th scope="col" class="color-black font-size-16 font-weight-700">Cantidad</th>
                            <th scope="col" class="color-black font-size-16 font-weight-700">Stock</th>

                            <th scope="col" class="color-black font-size-16 font-weight-700">Precio del producto</th>
                            <th scope="col" class="color-black font-size-16 font-weight-700">Monto total</th>
                            <th scope="col" class="color-black font-size-16 font-weight-700"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let item of products; let i=index">
                            <td scope="row">
                                <img class="img-product lazyload" style=" max-width: 80px; max-height: 80px;" *ngIf="item?.product_images.length >0" src="{{getImageProduct(item?.product_images[0].image)}}">
                                <p class="text-two-lines color-blue font-size-15 font-weight-700 mb-1">{{item.products_name}}</p>
                            </td>
                            <td>
                                <p class="text-two-lines color-blue font-size-15 font-weight-700 mb-1">{{item.subcategories_description}}
                                </p>
                            </td>
                            <td style="    width: 230px;">
                                <!--(emitAlertEvent)="eventAlertEmit($event)"-->
                                <p class="d-flex justify-content-end mb-0 mr-2 ml-2">
                                    <input class="form-control input-cantidad-store border-input text-center mr-2" (change)="updatequantity($event.target.value,item.products_id)" (keyup)="updatequantity($event.target.value,item.products_id)" (keydown)="updatequantity($event.target.value,item.products_id)"
                                        id='input-product-quantity-{{item.products_id}}' [value]="item.products_cart_quantity" type="number" placeholder="Cantidad">

                                </p>
                                <div role="alert" #alert class="alert d-none mt-3 text-center mb-0 alert-success alert-success-check" id='alert-product-cart-{{item.products_id}}'>
                                    <i class="fas fa-check"></i> ¡Agregado al carrito!
                                </div>

                            </td>
                            <td>
                                <p class="d-flex mb-1 font-size-14 font-weight-700">
                                    {{item?.product_type_sale_stock}} Unid. disponibles
                                </p>
                            </td>
                            <td>
                                <p class="d-flex mb-1 font-size-14 font-weight-700">
                                    S/{{item?.product_type_sale_price}} {{item?.product_type_sale_type}}.
                                </p>
                                <p class="d-flex mb-0 font-size-10 font-weight-700">
                                    <span class="badge badge-first">{{(item?.product_type_sale_discount!=null||item?.product_type_sale_discount!=0)?item?.product_type_sale_discount:0}} <i class="mdi mdi-percent"></i>
                    dsct</span>
                                </p>
                                <hr />
                                <p>Precio con descuento:
                                    <input class="form-control input-cantidad-store border-input text-center mr-2" value="{{item?.product_type_sale_price_with_discount | number : '.1-3'}}" id='input-product-with-discount-{{item.products_id}}' type="number" (change)="updateprice($event.target.value,item.products_id)"
                                        (keyup)="updateprice($event.target.value,item.products_id)" (keydown)="updateprice($event.target.value,item.products_id)" placeholder="Ingrese precio" style="max-width:130px">

                                </p>
                            </td>
                            <td>
                                <p class="d-flex mb-0 font-size-10 font-weight-700">
                                    <span class="color-coral discunt" id='input-price-subtotal-{{item.products_id}}'>{{item?.products_cart_price | number : '.1-3'}}</span>
                                </p>
                            </td>
                            <td>
                                <p class="close-canasta">
                                    <button type="button" (click)="editCart(item.products_id,item.order_details_id,'cart')" class="btn btn-first btn-sm border-input mr-2">
                    Actualizar
                  </button>
                                    <button (click)="remove(item.products_id, item.order_details_id)" class="p-2 button-coral-border btn btn-second border-0 txt-middle-500 height-40">
                    <i class="mdi mdi-close"></i>
                  </button>
                                </p>
                            </td>
                        </tr>
                        <tr *ngIf="products.length == 0">
                            <td scope="row" class="text-center" colspan="7">
                                Cargando ...
                            </td>
                        </tr>
                    </tbody>
                </table>
                <hr />


            </div>
            <div>
                <h4>
                    <em>Precio Total:</em> <span id='price-total-span-general'>{{precioTotal | number : '.1-3'}}</span>
                </h4>
            </div>
        </div>
    </div>
</div>
